Stripped to the bare minimum by Nils Maier for FastPreview.